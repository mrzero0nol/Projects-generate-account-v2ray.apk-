<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Konfigurasi</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f0f0; padding: 20px; }
        .container { max-width: 600px; margin: auto; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        label { display: block; margin-bottom: 10px; font-weight: bold; }
        select, button, textarea { width: 100%; padding: 10px; margin-bottom: 20px; border-radius: 4px; border: 1px solid #ccc; font-size: 16px; }
        button { background-color: #007bff; color: white; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        textarea { min-height: 150px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Generator Konfigurasi VLESS & Trojan</h1>

        <label for="proxySelect">Pilih Proksi:</label>
        <select id="proxySelect">
            <option>Memuat proksi...</option>
        </select>

        <button id="generateBtn">Generate</button>

        <label for="result">Hasil:</label>
        <textarea id="result" readonly></textarea>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const proxySelect = document.getElementById('proxySelect');
            const generateBtn = document.getElementById('generateBtn');
            const resultText = document.getElementById('result');
            let proxyList = [];

            // --- Fungsi Helper (diadaptasi dari Web.js) ---
            function generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }

            function parseTextProxies(text) {
                const items = [];
                const lines = text.split(/\r?\n/);
                for (let line of lines) {
                    line = line.trim();
                    if (!line || line.startsWith("#")) continue;
                    const parts = line.split(',');
                    if (parts.length >= 4) {
                        const ip = parts[0].trim();
                        const port = parseInt(parts[1].trim(), 10);
                        const country = parts[2].trim().toUpperCase();
                        const label = parts.slice(3).join(',').trim();
                        if (ip && port && country) {
                            items.push({ ip, port, country, label });
                        }
                    }
                }
                return items;
            }

            function buildURIs(proxy) {
                const frontDomain = "df.game.naver.com";
                const sni = "df.game.naver.com.ukonskypea.dpdns.org";
                const cfTlsPort = 443;
                const ip = proxy.ip;
                const backendPort = proxy.port;
                const tagLabel = `${proxy.label} [${ip}]`;
                const path = `/${ip}-${backendPort}`;
                const qpath = encodeURIComponent(path);

                const pass = generateUUID();
                const trojan = `trojan://${pass}@${frontDomain}:${cfTlsPort}/?type=ws&host=${sni}&path=${qpath}&security=tls&sni=${sni}#${encodeURIComponent(tagLabel)}`;

                const uuid = generateUUID();
                const vless = `vless://${uuid}@${frontDomain}:${cfTlsPort}/?type=ws&encryption=none&flow=&host=${sni}&path=${qpath}&security=tls&sni=${sni}#${encodeURIComponent(tagLabel)}`;

                return { trojan, vless };
            }

            // --- Logika Utama ---
            async function loadProxies() {
                try {
                    const response = await fetch('https://raw.githubusercontent.com/mrzero0nol/My-v2ray/refs/heads/main/proxyList.txt');
                    if (!response.ok) throw new Error('Gagal mengambil data');
                    const text = await response.text();

                    proxyList = parseTextProxies(text);

                    proxySelect.innerHTML = ''; // Hapus opsi "loading"
                    proxyList.forEach((proxy, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `${proxy.country} - ${proxy.label} (${proxy.ip})`;
                        proxySelect.appendChild(option);
                    });

                } catch (error) {
                    proxySelect.innerHTML = '<option>Gagal memuat proksi</option>';
                    console.error('Error loading proxies:', error);
                }
            }

            generateBtn.addEventListener('click', () => {
                if (proxyList.length === 0 || proxySelect.value === "") {
                    resultText.value = "Silakan pilih proksi yang valid terlebih dahulu.";
                    return;
                }
                const selectedProxy = proxyList[proxySelect.value];
                const { trojan, vless } = buildURIs(selectedProxy);
                resultText.value = `VLESS:\n${vless}\n\nTROJAN:\n${trojan}`;
            });

            loadProxies();
        });
    </script>
</body>
</html>